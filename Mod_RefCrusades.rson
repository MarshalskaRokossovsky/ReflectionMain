{
    "FileID": 573785173,
    "FileVersion": 8,
    "ViewPos.x": -631,
    "ViewPos.y": -502,
    "ScriptName": "Mod_RefCrusades",
    "ScriptFileOut": "C:\\Users\\DmitB\\Documents\\Фиксы\\Reflection Fixes\\Mods\\Reflection\\RefCrusades\\DATA\\Script\\Mod_RefCrusades.scr",
    "ScriptTextOut": "C:\\Users\\DmitB\\Documents\\Фиксы\\Reflection Fixes\\Mods\\Reflection\\RefCrusades\\DATA\\Script\\Mod_RefCrusades.txt",
    "LangDatIn": "",
    "LangDatOut": "",
    "MainDatIn": "",
    "MainDatOut": "",
    "CacheDatIn": "",
    "CacheDatOut": "",
    "ExportLangTxt": false,
    "ExportLangDat": false,
    "Visual.Objects": 
    [
        {
            "Groups": 
            [
                {
                    "Type": "TGroup",
                    "Name": "GroupNew",
                    "Pos.x": -100,
                    "Pos.y": 0,
                    "Parent": -1,
                    "#": 4,
                    "Owner": 62,
                    "Group.Type": 126,
                    "CntShipMin": 1,
                    "CntShipMax": 1,
                    "SpeedMin": 100,
                    "SpeedMax": 10000,
                    "Weapon": 0,
                    "CargoHook": 0,
                    "EmptySpace": 0,
                    "AddPlayer": true,
                    "StatusTraderMin": 0,
                    "StatusTraderMax": 100,
                    "StatusWarriorMin": 0,
                    "StatusWarriorMax": 100,
                    "StatusPirateMin": 0,
                    "StatusPirateMax": 100,
                    "DistSearch": 10000,
                    "Dialog": -1,
                    "StrengthMin": "0",
                    "StrengthMax": "0",
                    "Ruins": ""
                },
                {
                    "Type": "TGroup",
                    "Name": "GroupTampliers",
                    "Pos.x": 20,
                    "Pos.y": 0,
                    "Parent": -1,
                    "#": 8,
                    "Owner": 62,
                    "Group.Type": 126,
                    "CntShipMin": 0,
                    "CntShipMax": 0,
                    "SpeedMin": 100,
                    "SpeedMax": 10000,
                    "Weapon": 0,
                    "CargoHook": 0,
                    "EmptySpace": 0,
                    "AddPlayer": false,
                    "StatusTraderMin": 0,
                    "StatusTraderMax": 100,
                    "StatusWarriorMin": 0,
                    "StatusWarriorMax": 100,
                    "StatusPirateMin": 0,
                    "StatusPirateMax": 100,
                    "DistSearch": 10000,
                    "Dialog": -1,
                    "StrengthMin": "0",
                    "StrengthMax": "0",
                    "Ruins": ""
                },
                {
                    "Type": "TGroup",
                    "Name": "GroupHospitaliers",
                    "Pos.x": 160,
                    "Pos.y": 0,
                    "Parent": -1,
                    "#": 9,
                    "Owner": 62,
                    "Group.Type": 126,
                    "CntShipMin": 0,
                    "CntShipMax": 0,
                    "SpeedMin": 100,
                    "SpeedMax": 10000,
                    "Weapon": 0,
                    "CargoHook": 0,
                    "EmptySpace": 0,
                    "AddPlayer": false,
                    "StatusTraderMin": 0,
                    "StatusTraderMax": 100,
                    "StatusWarriorMin": 0,
                    "StatusWarriorMax": 100,
                    "StatusPirateMin": 0,
                    "StatusPirateMax": 100,
                    "DistSearch": 10000,
                    "Dialog": -1,
                    "StrengthMin": "0",
                    "StrengthMax": "0",
                    "Ruins": ""
                },
                {
                    "Type": "TGroup",
                    "Name": "GroupLazar",
                    "Pos.x": 310,
                    "Pos.y": 0,
                    "Parent": -1,
                    "#": 10,
                    "Owner": 62,
                    "Group.Type": 126,
                    "CntShipMin": 0,
                    "CntShipMax": 0,
                    "SpeedMin": 100,
                    "SpeedMax": 10000,
                    "Weapon": 0,
                    "CargoHook": 0,
                    "EmptySpace": 0,
                    "AddPlayer": false,
                    "StatusTraderMin": 0,
                    "StatusTraderMax": 100,
                    "StatusWarriorMin": 0,
                    "StatusWarriorMax": 100,
                    "StatusPirateMin": 0,
                    "StatusPirateMax": 100,
                    "DistSearch": 10000,
                    "Dialog": -1,
                    "StrengthMin": "0",
                    "StrengthMax": "0",
                    "Ruins": ""
                }
            ],
            "Operations": 
            [
                {
                    "Type": "Top",
                    "Name": "",
                    "Pos.x": -50,
                    "Pos.y": -90,
                    "Parent": -1,
                    "#": 5,
                    "Code.Type": "Global",
                    "Code": 
                    [
                        "GRun();"
                    ]
                },
                {
                    "Type": "Top",
                    "Name": "",
                    "Pos.x": -50,
                    "Pos.y": -130,
                    "Parent": -1,
                    "#": 6,
                    "Code.Type": "Turn",
                    "Code": 
                    [
                        "if(CrusSpent < 9) {",
                        "    if(!CoalitionDefeated()) {",
                        "        //NewsAdd('Ход '+CurTurn()+', Походов проведено '+CrusSpent+', до следующего похода осталось '+CrusadeCD+', флаг похода - '+CrusFlag+', в группах крестоносцев '+GroupCount(GroupHospitaliers)+' госпитальеров, '+GroupCount(GroupLazar)+' лазаритов, '+GroupCount(GroupTampliers)+' тамплиеров.');",
                        "        if(ControlledSystems(0)) {",
                        "            if(CrusadeCD) {",
                        "                if(!CrusFlag) {",
                        "                    CrusadeCD = CrusadeCD - 1;",
                        "                }",
                        "            }",
                        "            else {",
                        "                if(!GroupCount(GroupTampliers) && !GroupCount(GroupHospitaliers) && !GroupCount(GroupLazar) && CrusFlag) {",
                        "                    CrusadeCD = Rnd(1200,2000);",
                        "                    CrusFlag = 0;",
                        "                }",
                        "",
                        "                if(!CrusFlag) {",
                        "                    CrusFlag = 1;",
                        "                    CrusSpent = CrusSpent + 1;",
                        "                    if(CrusSpent == 1) tstr = \"Первого\";",
                        "                    if(CrusSpent == 2) tstr = \"Второго\";",
                        "                    if(CrusSpent == 3) tstr = \"Третьего\";",
                        "                    if(CrusSpent == 4) tstr = \"Четвёртого\";",
                        "                    if(CrusSpent == 5) tstr = \"Пятого\";",
                        "                    if(CrusSpent == 6) tstr = \"Шестого\";",
                        "                    if(CrusSpent == 7) tstr = \"Седьмого\";",
                        "                    if(CrusSpent == 8) tstr = \"Восьмого\";",
                        "                    if(CrusSpent == 9) tstr = \"Девятого\";",
                        "",
                        "                    /*for(i=0;GalaxyStars()>i;i=i+1) {",
                        "                        star = GalaxyStar(i);",
                        "                        if(StarOwner(star)) continue;",
                        "                        break;",
                        "                    }*/",
                        "                    i = 0;",
                        "                    while(1) {",
                        "                        star = GalaxyStar(Rnd(0,GalaxyStars()-1));",
                        "",
                        "                        //Чтобы не зациклилось",
                        "                        i = i + 1;",
                        "                        if(i > 500) break;",
                        "                        ",
                        "                        if(StarOwner(star)) continue;",
                        "                        if(StarCustomFaction(star)!= '') continue;",
                        "                        if(StarBattle(star)) continue;",
                        "                        break;",
                        "                    }",
                        "                    tstr = Format(CT('Script.Mod_RefCrusades.Start'),'name',tstr,'star',Name(star));",
                        "                    NewsAdd(tstr);",
                        "                    AddPlanetNews(tstr,85);",
                        "                    Sound('Sound.NewMsg');",
                        "",
                        "                    dword plan;",
                        "                    for(i=0;StarPlanets(star)>i;i=i+1) {",
                        "                        if(PlanetOwner(StarPlanets(star,i)) == 6) continue;",
                        "                        plan = StarPlanets(star,i);",
                        "                        break;",
                        "                    }",
                        "",
                        "                    int coun = 10;",
                        "                    coun = coun + CrusSpent * 3;",
                        "                    if(GalaxyDiffLevels() > 100) coun = coun + 3;",
                        "                    if(GalaxyDiffLevels() > 200) coun = coun + 5;",
                        "                    if(GalaxyDiffLevels() > 300) coun = coun + 7;",
                        "                    if(GalaxyDiffLevels() > 400) coun = coun + 9;",
                        "                    if(GalaxyDiffLevels() >= 500) coun = coun + 11;",
                        "",
                        "                    CrusadeCD = Rnd(1200,2000);",
                        "",
                        "                    was_l = Id(star);",
                        "                    was_t = Id(star);",
                        "                    was_h = Id(star);",
                        "",
                        "                    for(i=1;i<=3;i=i+1) {",
                        "                        g_SpawnLeader(plan,i);",
                        "                        for(j=0;j<coun;j=j+1) {",
                        "                            g_SpawnWarrior(plan,i);",
                        "                        }",
                        "                    }",
                        "                }",
                        "            }",
                        "        }",
                        "    }",
                        "",
                        "    if(ControlledSystems(1) == 0) {",
                        "        CrusSpent = 9;",
                        "        AllShipOut();",
                        "    }",
                        "}"
                    ]
                },
                {
                    "Type": "Top",
                    "Name": "",
                    "Pos.x": -10,
                    "Pos.y": -110,
                    "Parent": -1,
                    "#": 7,
                    "Code.Type": "Init",
                    "Code": 
                    [
                        "function g_SpawnLeader(dword plan, int type) {",
                        "    dword ship1;",
                        "",
                        "    if(type == 1) {",
                        "        //Тамплиер, красный",
                        "        ship1 = BuyWarrior(plan,950);",
                        "        ShipRefit(ship1,350+GalaxyTechLevel()*200,100000+GalaxyTechLevel()*200000);",
                        "        ShipRefit(ship1);",
                        "",
                        "        //Чтобы не было вопросов - почему у чувака с бонусом к ракетам ракет НЕТУ",
                        "        if(ShipEqInSlot(ship1,t_Weapon1,1)) {",
                        "            if(GetEquipmentStats(ShipEqInSlot(ship1,t_Weapon1,1),3) != 2) {",
                        "                FreeItem(GetItemFromShip(ship1,ShipEqInSlot(ship1,t_Weapon1,1)));",
                        "                AddItemToShip(ship1,CreateEquipment(t_Weapon4,Rnd(15,20),GalaxyTechLevel(),PlanetOwner(plan)));",
                        "                ArrangeItems(ship1);",
                        "            }",
                        "        }",
                        "",
                        "        HullSpecial(ShipEqInSlot(ship1,t_Hull),FindBonusByNameInCfg('RefCrusader_LeaderTamplier'));",
                        "        Chameleon(ship1,'Ship.Akrin.LT');",
                        "        ItemLevel(ShipEqInSlot(ship1,t_Hull),GalaxyTechLevel());",
                        "        ShipType(ship1,'CrusaderLeader');",
                        "        SetName(ship1,CT('Script.Mod_RefCrusades.TamplierLeader'));",
                        "        ShipImproveItems(ship1,25);",
                        "        ShipJoin(GroupTampliers,ship1,'',0,2);",
                        "    }",
                        "    else if(type == 2) {",
                        "        //Госпитальер, чёрный",
                        "        ship1 = BuyWarrior(plan,950);",
                        "        ShipRefit(ship1,350+GalaxyTechLevel()*200,100000+GalaxyTechLevel()*200000);",
                        "        ShipRefit(ship1);",
                        "",
                        "        HullSpecial(ShipEqInSlot(ship1,t_Hull),FindBonusByNameInCfg('RefCrusader_LeaderHospitalier'));",
                        "        Chameleon(ship1,'Ship.Akrin.LH');",
                        "        ItemLevel(ShipEqInSlot(ship1,t_Hull),GalaxyTechLevel());",
                        "        ShipType(ship1,'CrusaderLeader');",
                        "        SetName(ship1,CT('Script.Mod_RefCrusades.HospitalierLeader'));",
                        "        ShipImproveItems(ship1,25);",
                        "        ShipJoin(GroupHospitaliers,ship1,'',0,2);",
                        "    }",
                        "    else if(type == 3) {",
                        "        //Лазарит, зелёный",
                        "        ship1 = BuyWarrior(plan,950);",
                        "        ShipRefit(ship1,350+GalaxyTechLevel()*200,100000+GalaxyTechLevel()*200000);",
                        "        ShipRefit(ship1);",
                        "",
                        "        HullSpecial(ShipEqInSlot(ship1,t_Hull),FindBonusByNameInCfg('RefCrusader_LeaderLazar'));",
                        "        Chameleon(ship1,'Ship.Akrin.LL');",
                        "        ItemLevel(ShipEqInSlot(ship1,t_Hull),GalaxyTechLevel());",
                        "        ShipType(ship1,'CrusaderLeader');",
                        "        SetName(ship1,CT('Script.Mod_RefCrusades.LazarLeader'));",
                        "        ShipImproveItems(ship1,25);",
                        "        ShipJoin(GroupLazar,ship1,'',0,2);",
                        "    }",
                        "    else throw 'Incorrect type ('+type+') of Crusade Leader - RefCrusades got critical error!!!';",
                        "",
                        "    //Мне? Да, лень расписывать диалоги для этих религиозных фанатиков",
                        "    NoTalkToShip(ship1,1);",
                        "",
                        "    //Чтобы не тормозились",
                        "    while(ShipSpeed(ship1) < 600) {",
                        "        ShipSpecialBonuses(ship1,bonSpeed,ShipSpecialBonuses(ship1,bonSpeed)+100);",
                        "        ShipCalcParam(ship1);",
                        "    }",
                        "}",
                        "",
                        "function g_SpawnWarrior(dword plan, int type) {",
                        "    dword ship1;",
                        "",
                        "    if(type == 1) {",
                        "        //Тамплиер, красный",
                        "        ship1 = BuyWarrior(plan,700);",
                        "        ShipRefit(ship1,Rnd(100,200)+GalaxyTechLevel()*150,50000+GalaxyTechLevel()*100000);",
                        "        ShipRefit(ship1);",
                        "",
                        "        //Чтобы не было вопросов - почему у чувака с бонусом к ракетам ракет НЕТУ",
                        "        if(ShipEqInSlot(ship1,t_Weapon1,1)) {",
                        "            if(GetEquipmentStats(ShipEqInSlot(ship1,t_Weapon1,1),3) != 2) {",
                        "                FreeItem(GetItemFromShip(ship1,ShipEqInSlot(ship1,t_Weapon1,1)));",
                        "                AddItemToShip(ship1,CreateEquipment(t_Weapon4,Rnd(15,20),GalaxyTechLevel(),PlanetOwner(plan)));",
                        "                ArrangeItems(ship1);",
                        "            }",
                        "        }",
                        "",
                        "        HullSpecial(ShipEqInSlot(ship1,t_Hull),FindBonusByNameInCfg('RefCrusader_KnightTamplier'));",
                        "        Chameleon(ship1,'Ship.Akrin.KT');",
                        "        ItemLevel(ShipEqInSlot(ship1,t_Hull),GalaxyTechLevel());",
                        "        ShipType(ship1,'Crusader');",
                        "        ShipImproveItems(ship1,10);",
                        "        ShipJoin(GroupTampliers,ship1,'',0,2);",
                        "    }",
                        "    else if(type == 2) {",
                        "        //Госпитальер, чёрный",
                        "        ship1 = BuyWarrior(plan,700);",
                        "        ShipRefit(ship1,Rnd(100,200)+GalaxyTechLevel()*150,50000+GalaxyTechLevel()*100000);",
                        "        ShipRefit(ship1);",
                        "",
                        "        HullSpecial(ShipEqInSlot(ship1,t_Hull),FindBonusByNameInCfg('RefCrusader_KnightHospitalier'));",
                        "        Chameleon(ship1,'Ship.Akrin.KH');",
                        "        ItemLevel(ShipEqInSlot(ship1,t_Hull),GalaxyTechLevel());",
                        "        ShipType(ship1,'Crusader');",
                        "        ShipImproveItems(ship1,15);",
                        "        ShipJoin(GroupHospitaliers,ship1,'',0,2);",
                        "    }",
                        "    else if(type == 3) {",
                        "        //Лазарит, зелёный",
                        "        ship1 = BuyWarrior(plan,700);",
                        "        ShipRefit(ship1,Rnd(100,200)+GalaxyTechLevel()*150,50000+GalaxyTechLevel()*100000);",
                        "        ShipRefit(ship1);",
                        "",
                        "        HullSpecial(ShipEqInSlot(ship1,t_Hull),FindBonusByNameInCfg('RefCrusader_KnightLazar'));",
                        "        Chameleon(ship1,'Ship.Akrin.KL');",
                        "        ItemLevel(ShipEqInSlot(ship1,t_Hull),GalaxyTechLevel());",
                        "        ShipType(ship1,'Crusader');",
                        "        ShipImproveItems(ship1,10);",
                        "        ShipJoin(GroupLazar,ship1,'',0,2);",
                        "    }",
                        "    else throw 'Incorrect type ('+type+') of Crusade Knight - RefCrusades got critical error!!!';",
                        "",
                        "    //Мне? Да, лень расписывать диалоги для этих религиозных фанатиков",
                        "    NoTalkToShip(ship1,1);",
                        "",
                        "    //Чтобы не тормозились",
                        "    while(ShipSpeed(ship1) < 600) {",
                        "        ShipSpecialBonuses(ship1,bonSpeed,ShipSpecialBonuses(ship1,bonSpeed)+100);",
                        "        ShipCalcParam(ship1);",
                        "    }",
                        "}",
                        "",
                        "function g_FillSystemsArr(dword cur_star, int type) {",
                        "    //1 - найти системы для защиты",
                        "    //2 - найти системы для атаки",
                        "",
                        "    int i;",
                        "    int j;",
                        "    dword star = 0;",
                        "    unknown tarr = newarray(1);",
                        "",
                        "    ArrayClear(tarr);",
                        "    ArrayDelete(tarr,0);",
                        "",
                        "    if(type == 1) {",
                        "        for(i=0;GalaxyStars()>i;i=i+1){",
                        "            star = StarNearbyStars(cur_star,i);",
                        "            if(StarOwner(star)) continue;",
                        "            if(!StarBattle(star)) continue;",
                        "",
                        "            break;",
                        "            //NewsAdd('RefCrusades '+Name(star));",
                        "        }",
                        "    }",
                        "    else {",
                        "        for(i=1;GalaxyStars()>i;i=i+1){",
                        "            star = StarNearbyStars(cur_star,i);",
                        "            if(!StarOwner(star) && StarCustomFaction(star) == '') continue;",
                        "            if(StarToCon(star) == StarToCon(PlanetToStar(PlanetPirateClan()))) {",
                        "                if(!PirateWin()) continue;",
                        "            }",
                        "            //Чтобы не летели со старта в атаку на Террончика",
                        "            if(Terron()) {",
                        "                if(ControlledSystems(1) > 1) {",
                        "                    if(star == ShipStar(Terron())) continue;",
                        "                }",
                        "                else if(ControlledSystems(2)) continue;",
                        "            }",
                        "",
                        "            break;",
                        "            //NewsAdd('RefCrusades-2 '+Name(star));",
                        "        }",
                        "    }",
                        "    //NewsAdd('RefCrusades-3');",
                        "",
                        "    if(!star) result = -1;",
                        "    else result = Id(star);",
                        "}",
                        "",
                        "CrusSpent = 0;"
                    ]
                },
                {
                    "Type": "Top",
                    "Name": "",
                    "Pos.x": 20,
                    "Pos.y": 80,
                    "Parent": -1,
                    "#": 14,
                    "Code.Type": "Turn",
                    "Code": 
                    [
                        "if(StarBattle(ShipStar(CurShip))) {",
                        "    ShipSpecialBonuses(CurShip,bonFuel,-5000000);",
                        "}",
                        "else ShipSpecialBonuses(CurShip,bonFuel,0);",
                        "",
                        "if(GetData(1) == 0) {",
                        "    if(!StarOwner(ShipStar(CurShip)) && !StarBattle(ShipStar(CurShip))) {",
                        "        SetData(2,1); //Корабли отправлены в атаку т.к. только родились и взлетели",
                        "        SetData(0,2);",
                        "",
                        "        targ_t = g_FillSystemsArr(ShipStar(CurShip),1);",
                        "        if(targ_t == -1) {",
                        "            targ_t = g_FillSystemsArr(ShipStar(CurShip),2);",
                        "        }",
                        "    }",
                        "}",
                        "else if(GetData(1) == 1) {",
                        "    if(GetShipPlanet(CurShip)) {",
                        "        ShipRefuel(CurShip);",
                        "        ShipRepairEq(CurShip);",
                        "        HullHP(CurShip,'To100');",
                        "        SetData(2,1); //Корабли починились, пора готовиться",
                        "        SetData(0,2);",
                        "    }",
                        "    else OrderLanding(CurShip,NearCivilPlanet(CurShip),100);",
                        "}",
                        "else if(GetData(1) == 2) {",
                        "    if(GetShipPlanet(CurShip)) {",
                        "        OrderTakeOff(CurShip);",
                        "    }",
                        "    else {",
                        "        OrderMove(CurShip,Rnd(450,700),Rnd(450,700));",
                        "        SetData(GetData(2)+1,2);",
                        "",
                        "        if(GetData(2) >= 8) {",
                        "            SetData(3,1); //Корабли приготовились, В АТАКУ",
                        "            was_t = Id(ShipStar(CurShip));",
                        "        }",
                        "    }",
                        "}",
                        "else if(GetData(1) == 3) {",
                        "    if(targ_t > 0) {",
                        "        if(ShipInNormalSpace(CurShip)) {",
                        "            if(ShipStar(CurShip) != GalaxyStar(targ_t - 1)) {",
                        "                OrderJump(CurShip,GalaxyStar(targ_t - 1));",
                        "            }",
                        "            else SetData(4,1); //Мы прибыли в систему, СМЕРТЬ ЕРЕТИКАМ",
                        "        }",
                        "    }",
                        "    else {",
                        "        targ_t = g_FillSystemsArr(ShipStar(CurShip),1);",
                        "        if(targ_t == -1) {",
                        "            targ_t = g_FillSystemsArr(ShipStar(CurShip),2);",
                        "            if(targ_t == -1) {",
                        "                SetData(2,1);",
                        "                SetData(0,2);",
                        "            }",
                        "        }",
                        "    }",
                        "}",
                        "else if(GetData(1) == 4) {",
                        "    if(!StarOwner(ShipStar(CurShip)) && !StarBattle(ShipStar(CurShip))) {",
                        "        SetData(1,1); //Корабли отправлены на починку",
                        "",
                        "        targ_t = g_FillSystemsArr(ShipStar(CurShip),1);",
                        "        if(targ_t == -1) {",
                        "            targ_t = g_FillSystemsArr(ShipStar(CurShip),2);",
                        "        }",
                        "    }",
                        "}",
                        "//Рандом диалоги фанатиков веры христовой",
                        "if(ShipInStar(Player(),ShipStar(CurShip))) {",
                        "    if(ShipInNormalSpace(Player())) {",
                        "        if(ShipInNormalSpace(CurShip)) {",
                        "            if(ShipRadarRange(CurShip) < Dist(Player(),CurShip)) {",
                        "                if(!Rnd(0,9)) {",
                        "                    Ether(1,'','-'+Name(CurShip)+':'+Format('<br>')+CT('Script.Mod_RefCrusades.RandomDialogs.'+Rnd(1,int(CT('Script.Mod_RefCrusades.RandomDialogs.Count')))));",
                        "                    Sound('Sound.NewMsg');",
                        "                }",
                        "            }",
                        "        }",
                        "    }",
                        "}"
                    ]
                },
                {
                    "Type": "Top",
                    "Name": "",
                    "Pos.x": 160,
                    "Pos.y": 80,
                    "Parent": -1,
                    "#": 15,
                    "Code.Type": "Turn",
                    "Code": 
                    [
                        "if(StarBattle(ShipStar(CurShip))) {",
                        "    ShipSpecialBonuses(CurShip,bonFuel,-5000000);",
                        "}",
                        "else ShipSpecialBonuses(CurShip,bonFuel,0);",
                        "",
                        "if(GetData(1) == 0) {",
                        "    if(!StarOwner(ShipStar(CurShip)) && !StarBattle(ShipStar(CurShip))) {",
                        "        SetData(2,1); //Корабли отправлены в атаку т.к. только родились и взлетели",
                        "        SetData(0,2);",
                        "",
                        "        targ_h = g_FillSystemsArr(ShipStar(CurShip),1);",
                        "        if(targ_h == -1) {",
                        "            targ_h = g_FillSystemsArr(ShipStar(CurShip),2);",
                        "        }",
                        "    }",
                        "}",
                        "else if(GetData(1) == 1) {",
                        "    if(GetShipPlanet(CurShip)) {",
                        "        ShipRefuel(CurShip);",
                        "        ShipRepairEq(CurShip);",
                        "        HullHP(CurShip,'To100');",
                        "        SetData(2,1); //Корабли починились, пора готовиться",
                        "    }",
                        "    else OrderLanding(CurShip,NearCivilPlanet(CurShip),100);",
                        "}",
                        "else if(GetData(1) == 2) {",
                        "    if(GetShipPlanet(CurShip)) {",
                        "        OrderTakeOff(CurShip);",
                        "    }",
                        "    else {",
                        "        OrderMove(CurShip,Rnd(450,700),Rnd(450,700));",
                        "        SetData(GetData(2)+1,2);",
                        "",
                        "        if(GetData(2) >= 8) {",
                        "            SetData(3,1); //Корабли приготовились, В АТАКУ",
                        "            was_h = Id(ShipStar(CurShip));",
                        "        }",
                        "    }",
                        "}",
                        "else if(GetData(1) == 3) {",
                        "    if(targ_h > 0) {",
                        "        if(ShipInNormalSpace(CurShip)) {",
                        "            if(ShipStar(CurShip) != GalaxyStar(targ_h - 1)) {",
                        "                OrderJump(CurShip,GalaxyStar(targ_h - 1));",
                        "            }",
                        "            else SetData(4,1); //Мы прибыли в систему, СМЕРТЬ ЕРЕТИКАМ",
                        "        }",
                        "    }",
                        "    else {",
                        "        targ_h = g_FillSystemsArr(ShipStar(CurShip),1);",
                        "        if(targ_h == -1) {",
                        "            targ_h = g_FillSystemsArr(ShipStar(CurShip),2);",
                        "            if(targ_h == -1) {",
                        "                SetData(2,1);",
                        "                SetData(0,2);",
                        "            }",
                        "        }",
                        "    }",
                        "}",
                        "else if(GetData(1) == 4) {",
                        "    if(!StarOwner(ShipStar(CurShip)) && !StarBattle(ShipStar(CurShip))) {",
                        "        SetData(1,1); //Корабли отправлены на починку",
                        "",
                        "        targ_h = g_FillSystemsArr(ShipStar(CurShip),1);",
                        "        if(targ_h == -1) {",
                        "            targ_h = g_FillSystemsArr(ShipStar(CurShip),2);",
                        "        }",
                        "    }",
                        "}",
                        "//Рандом диалоги фанатиков веры христовой",
                        "if(ShipInStar(Player(),ShipStar(CurShip))) {",
                        "    if(ShipInNormalSpace(Player())) {",
                        "        if(ShipInNormalSpace(CurShip)) {",
                        "            if(ShipRadarRange(CurShip) < Dist(Player(),CurShip)) {",
                        "                if(!Rnd(0,9)) {",
                        "                    Ether(1,'','-'+Name(CurShip)+':'+Format('<br>')+CT('Script.Mod_RefCrusades.RandomDialogs.'+Rnd(1,int(CT('Script.Mod_RefCrusades.RandomDialogs.Count')))));",
                        "                    Sound('Sound.NewMsg');",
                        "                }",
                        "            }",
                        "        }",
                        "    }",
                        "}"
                    ]
                },
                {
                    "Type": "Top",
                    "Name": "",
                    "Pos.x": 310,
                    "Pos.y": 80,
                    "Parent": -1,
                    "#": 16,
                    "Code.Type": "Turn",
                    "Code": 
                    [
                        "if(StarBattle(ShipStar(CurShip))) {",
                        "    ShipSpecialBonuses(CurShip,bonFuel,-5000000);",
                        "}",
                        "else ShipSpecialBonuses(CurShip,bonFuel,0);",
                        "",
                        "if(GetData(1) == 0) {",
                        "    if(!StarOwner(ShipStar(CurShip)) && !StarBattle(ShipStar(CurShip))) {",
                        "        SetData(2,1); //Корабли отправлены в атаку т.к. только родились и взлетели",
                        "        SetData(0,2);",
                        "",
                        "        targ_l = g_FillSystemsArr(ShipStar(CurShip),1);",
                        "        if(targ_l == -1) {",
                        "            targ_l = g_FillSystemsArr(ShipStar(CurShip),2);",
                        "        }",
                        "    }",
                        "}",
                        "else if(GetData(1) == 1) {",
                        "    if(GetShipPlanet(CurShip)) {",
                        "        ShipRefuel(CurShip);",
                        "        ShipRepairEq(CurShip);",
                        "        HullHP(CurShip,'To100');",
                        "        SetData(2,1); //Корабли починились, пора готовиться",
                        "    }",
                        "    else OrderLanding(CurShip,NearCivilPlanet(CurShip),100);",
                        "}",
                        "else if(GetData(1) == 2) {",
                        "    if(GetShipPlanet(CurShip)) {",
                        "        OrderTakeOff(CurShip);",
                        "    }",
                        "    else {",
                        "        OrderMove(CurShip,Rnd(450,700),Rnd(450,700));",
                        "        SetData(GetData(2)+1,2);",
                        "",
                        "        if(GetData(2) >= 8) {",
                        "            SetData(3,1); //Корабли приготовились, В АТАКУ",
                        "            was_l = Id(ShipStar(CurShip));",
                        "        }",
                        "    }",
                        "}",
                        "else if(GetData(1) == 3) {",
                        "    if(targ_l > 0) {",
                        "        if(ShipInNormalSpace(CurShip)) {",
                        "            if(ShipStar(CurShip) != GalaxyStar(targ_l - 1)) {",
                        "                OrderJump(CurShip,GalaxyStar(targ_l - 1));",
                        "            }",
                        "            else SetData(4,1); //Мы прибыли в систему, СМЕРТЬ ЕРЕТИКАМ",
                        "        }",
                        "    }",
                        "    else {",
                        "        targ_l = g_FillSystemsArr(ShipStar(CurShip),1);",
                        "        if(targ_l == -1) {",
                        "            targ_l = g_FillSystemsArr(ShipStar(CurShip),2);",
                        "            if(targ_l == -1) {",
                        "                SetData(2,1);",
                        "                SetData(0,2);",
                        "            }",
                        "        }",
                        "    }",
                        "}",
                        "else if(GetData(1) == 4) {",
                        "    if(!StarOwner(ShipStar(CurShip)) && !StarBattle(ShipStar(CurShip))) {",
                        "        SetData(1,1); //Корабли отправлены на починку",
                        "",
                        "        targ_l = g_FillSystemsArr(ShipStar(CurShip),1);",
                        "        if(targ_l == -1) {",
                        "            targ_l = g_FillSystemsArr(ShipStar(CurShip),2);",
                        "        }",
                        "    }",
                        "}",
                        "//Рандом диалоги фанатиков веры христовой",
                        "if(ShipInStar(Player(),ShipStar(CurShip))) {",
                        "    if(ShipInNormalSpace(Player())) {",
                        "        if(ShipInNormalSpace(CurShip)) {",
                        "            if(ShipRadarRange(CurShip) < Dist(Player(),CurShip)) {",
                        "                if(!Rnd(0,9)) {",
                        "                    Ether(1,'','-'+Name(CurShip)+':'+Format('<br>')+CT('Script.Mod_RefCrusades.RandomDialogs.'+Rnd(1,int(CT('Script.Mod_RefCrusades.RandomDialogs.Count')))));",
                        "                    Sound('Sound.NewMsg');",
                        "                }",
                        "            }",
                        "        }",
                        "    }",
                        "}"
                    ]
                }
            ],
            "Planets": 
            [
                {
                    "Type": "TPlanet",
                    "Name": "PlanetNew",
                    "Pos.x": -100,
                    "Pos.y": -30,
                    "Parent": -1,
                    "#": 1,
                    "Race": 62,
                    "Owner": 62,
                    "Economy": 14,
                    "Goverment": 62,
                    "RangeMin": 0,
                    "RangeMax": 100,
                    "Dialog": -1
                }
            ],
            "Ships": 
            [
                {
                    "Type": "TStarShip",
                    "Name": "",
                    "Pos.x": -100,
                    "Pos.y": -90,
                    "Parent": -1,
                    "#": 2,
                    "Count": 1,
                    "Owner": 62,
                    "Ship.Type": 126,
                    "Player": true,
                    "SpeedMin": 0,
                    "SpeedMax": 10000,
                    "Weapon": 0,
                    "CargoHook": 0,
                    "EmptySpace": 0,
                    "StatusTraderMin": 0,
                    "StatusTraderMax": 100,
                    "StatusWarriorMin": 0,
                    "StatusWarriorMax": 100,
                    "StatusPirateMin": 0,
                    "StatusPirateMax": 100,
                    "StrengthMin": "0",
                    "StrengthMax": "0",
                    "Ruins": ""
                }
            ],
            "Stars": 
            [
                {
                    "Type": "TStar",
                    "Name": "StarNew",
                    "Pos.x": -100,
                    "Pos.y": -60,
                    "Parent": -1,
                    "#": 0,
                    "Constellation": 0,
                    "Priority": 0,
                    "NoKling": false,
                    "NoComeKling": false
                }
            ],
            "States": 
            [
                {
                    "Type": "TState",
                    "Name": "StateNew",
                    "Pos.x": -100,
                    "Pos.y": 30,
                    "Parent": -1,
                    "#": 3,
                    "Move": 0,
                    "MoveObj": -1,
                    "Attack.Count": 0,
                    "TakeItem": -1,
                    "TakeAllItem": false,
                    "OnTalk": "",
                    "OnActCode": "",
                    "EType": 1,
                    "EUnique": "",
                    "EMsg": ""
                },
                {
                    "Type": "TState",
                    "Name": "StateTampliers",
                    "Pos.x": 20,
                    "Pos.y": 40,
                    "Parent": -1,
                    "#": 11,
                    "Move": 5,
                    "MoveObj": -1,
                    "Attack.Count": 0,
                    "TakeItem": -1,
                    "TakeAllItem": false,
                    "OnTalk": "",
                    "OnActCode": "",
                    "EType": 1,
                    "EUnique": "",
                    "EMsg": ""
                },
                {
                    "Type": "TState",
                    "Name": "StateHospitailers",
                    "Pos.x": 160,
                    "Pos.y": 40,
                    "Parent": -1,
                    "#": 12,
                    "Move": 5,
                    "MoveObj": -1,
                    "Attack.Count": 0,
                    "TakeItem": -1,
                    "TakeAllItem": false,
                    "OnTalk": "",
                    "OnActCode": "",
                    "EType": 1,
                    "EUnique": "",
                    "EMsg": ""
                },
                {
                    "Type": "TState",
                    "Name": "StateLazar",
                    "Pos.x": 310,
                    "Pos.y": 40,
                    "Parent": -1,
                    "#": 13,
                    "Move": 5,
                    "MoveObj": -1,
                    "Attack.Count": 0,
                    "TakeItem": -1,
                    "TakeAllItem": false,
                    "OnTalk": "",
                    "OnActCode": "",
                    "EType": 1,
                    "EUnique": "",
                    "EMsg": ""
                }
            ],
            "Variables": 
            [
                {
                    "Type": "TVar",
                    "Name": "targ_l",
                    "Pos.x": 60,
                    "Pos.y": -80,
                    "Parent": -1,
                    "#": 17,
                    "Var.Type": "Dword",
                    "Init": "",
                    "Global": false
                },
                {
                    "Type": "TVar",
                    "Name": "targ_h",
                    "Pos.x": 60,
                    "Pos.y": -110,
                    "Parent": -1,
                    "#": 18,
                    "Var.Type": "Dword",
                    "Init": "",
                    "Global": false
                },
                {
                    "Type": "TVar",
                    "Name": "targ_t",
                    "Pos.x": 60,
                    "Pos.y": -140,
                    "Parent": -1,
                    "#": 19,
                    "Var.Type": "Dword",
                    "Init": "",
                    "Global": false
                },
                {
                    "Type": "TVar",
                    "Name": "i",
                    "Pos.x": 60,
                    "Pos.y": -170,
                    "Parent": -1,
                    "#": 20,
                    "Var.Type": "Int",
                    "Init": "",
                    "Global": false
                },
                {
                    "Type": "TVar",
                    "Name": "j",
                    "Pos.x": 110,
                    "Pos.y": -170,
                    "Parent": -1,
                    "#": 21,
                    "Var.Type": "Int",
                    "Init": "",
                    "Global": false
                },
                {
                    "Type": "TVar",
                    "Name": "systems",
                    "Pos.x": 160,
                    "Pos.y": -170,
                    "Parent": -1,
                    "#": 22,
                    "Var.Type": "Array",
                    "Init": "",
                    "Global": false
                },
                {
                    "Type": "TVar",
                    "Name": "CrusadeCD",
                    "Pos.x": 160,
                    "Pos.y": -80,
                    "Parent": -1,
                    "#": 23,
                    "Var.Type": "Int",
                    "Init": "5",
                    "Global": false
                },
                {
                    "Type": "TVar",
                    "Name": "CrusSpent",
                    "Pos.x": 160,
                    "Pos.y": -110,
                    "Parent": -1,
                    "#": 24,
                    "Var.Type": "Int",
                    "Init": "0",
                    "Global": false
                },
                {
                    "Type": "TVar",
                    "Name": "CrusFlag",
                    "Pos.x": 160,
                    "Pos.y": -140,
                    "Parent": -1,
                    "#": 25,
                    "Var.Type": "Int",
                    "Init": "0",
                    "Global": false
                },
                {
                    "Type": "TVar",
                    "Name": "tstr",
                    "Pos.x": 60,
                    "Pos.y": -200,
                    "Parent": -1,
                    "#": 26,
                    "Var.Type": "Str",
                    "Init": "",
                    "Global": false
                },
                {
                    "Type": "TVar",
                    "Name": "star",
                    "Pos.x": 160,
                    "Pos.y": -200,
                    "Parent": -1,
                    "#": 27,
                    "Var.Type": "Dword",
                    "Init": "",
                    "Global": false
                },
                {
                    "Type": "TVar",
                    "Name": "ship",
                    "Pos.x": 270,
                    "Pos.y": -170,
                    "Parent": -1,
                    "#": 28,
                    "Var.Type": "Dword",
                    "Init": "",
                    "Global": false
                },
                {
                    "Type": "TVar",
                    "Name": "was_t",
                    "Pos.x": 270,
                    "Pos.y": -140,
                    "Parent": -1,
                    "#": 29,
                    "Var.Type": "Dword",
                    "Init": "",
                    "Global": false
                },
                {
                    "Type": "TVar",
                    "Name": "was_h",
                    "Pos.x": 270,
                    "Pos.y": -110,
                    "Parent": -1,
                    "#": 30,
                    "Var.Type": "Dword",
                    "Init": "",
                    "Global": false
                },
                {
                    "Type": "TVar",
                    "Name": "was_l",
                    "Pos.x": 270,
                    "Pos.y": -80,
                    "Parent": -1,
                    "#": 31,
                    "Var.Type": "Dword",
                    "Init": "",
                    "Global": false
                }
            ]
        }
    ],
    "Visual.Links": 
    [
        {
            "Type": "TGraphLink",
            "Begin": 2,
            "End": 0,
            "Nom": 0,
            "Arrow": true
        },
        {
            "Type": "TGraphLink",
            "Begin": 1,
            "End": 0,
            "Nom": 0,
            "Arrow": true
        },
        {
            "Type": "TGraphLink",
            "Begin": 4,
            "End": 1,
            "Nom": 0,
            "Arrow": true
        },
        {
            "Type": "TGraphLink",
            "Begin": 4,
            "End": 3,
            "Nom": 0,
            "Arrow": true
        },
        {
            "Type": "TGraphLink",
            "Begin": 8,
            "End": 1,
            "Nom": 0,
            "Arrow": true
        },
        {
            "Type": "TGraphLink",
            "Begin": 9,
            "End": 1,
            "Nom": 0,
            "Arrow": true
        },
        {
            "Type": "TGraphLink",
            "Begin": 10,
            "End": 1,
            "Nom": 0,
            "Arrow": true
        },
        {
            "Type": "TGraphLink",
            "Begin": 8,
            "End": 11,
            "Nom": 0,
            "Arrow": true
        },
        {
            "Type": "TGraphLink",
            "Begin": 9,
            "End": 12,
            "Nom": 0,
            "Arrow": true
        },
        {
            "Type": "TGraphLink",
            "Begin": 10,
            "End": 13,
            "Nom": 0,
            "Arrow": true
        },
        {
            "Type": "TGraphLink",
            "Begin": 11,
            "End": 14,
            "Nom": 0,
            "Arrow": true
        },
        {
            "Type": "TGraphLink",
            "Begin": 12,
            "End": 15,
            "Nom": 0,
            "Arrow": true
        },
        {
            "Type": "TGraphLink",
            "Begin": 13,
            "End": 16,
            "Nom": 0,
            "Arrow": true
        }
    ],
    "BlockPar.EC.Total.Strings": 9,
    "BlockPar.EC": 
    [
        {
            "#": "10",
            "String": "Четвёртого"
        },
        {
            "#": "11",
            "String": "Третьего"
        },
        {
            "#": "12",
            "String": "Второго"
        },
        {
            "#": "13",
            "String": "Первого"
        },
        {
            "#": "5",
            "String": "Девятого"
        },
        {
            "#": "6",
            "String": "Восьмого"
        },
        {
            "#": "7",
            "String": "Седьмого"
        },
        {
            "#": "8",
            "String": "Шестого"
        },
        {
            "#": "9",
            "String": "Пятого"
        }
    ]
}